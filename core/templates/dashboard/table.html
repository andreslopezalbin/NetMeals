{% extends "dashboard/dashboard_master.html" %}
{% load staticfiles %}
{% load i18n %}

{% block content %}


    <div class="wrapper">

        <div class="main-panel">
            <nav class="navbar navbar-transparent navbar-absolute">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <p class="navbar-brand" href="#">Table List</p>
                    </div>
                </div>
            </nav>

            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header" data-background-color="purple">
                                    <h4 class="title">{% trans 'Users Table' %}</h4>
                                    <p class="category">{% trans 'Management of users' %}</p>
                                </div>
                                <div class="card-content table-responsive">
                                    <table class="table table-hover">
                                        <thead class="text-primary ">
                                        <th>{% trans 'Username' %}</th>
                                        <th>{% trans 'Name' %}</th>
                                        <th>{% trans 'Email' %}</th>
                                        <th>{% trans 'Last login' %}</th>
                                        <th>{% trans 'Deactivate' %}</th>
                                        </thead>
                                        <tbody>
                                        {% for user in users %}
                                            <tr>

                                                <td> {{ user.username }}</td>
                                                <td>{{ user.first_name }}</td>
                                                <td>{{ user.email }}</td>
                                                <td>{{ user.last_login }}</td>
                                                <td>
                                                    {% if user.is_active %}
                                                        <a id="user-deactivate"
                                                           class=" btn btn-primary deactivated {{ user.id }}"
                                                           href="#"
                                                           data-url='{% url "users_deactivate" user.id %}'
                                                           data-userid="{{ user.id }}">
                                                            <span>{% trans 'Deactivate' %}</span>
                                                        </a>
                                                        <a id="user-activate"
                                                           class=" btn btn-primary activated {{ user.id }}"
                                                           href="#" style="display: none"
                                                           data-url='{% url "users_activate" user.id %}'
                                                           data-userid="{{ user.id }}">
                                                            <span>{% trans 'Activate' %}</span>
                                                        </a>
                                                    {% else %}
                                                        <a id="user-activate"
                                                           class=" btn btn-primary activated {{ user.id }}"
                                                           href="#"
                                                           data-url='{% url "users_activate" user.id %}'
                                                           data-userid="{{ user.id }}">
                                                            <span>{% trans 'Activate' %}</span>
                                                        </a>
                                                        <a id="user-deactivate"
                                                           class=" btn btn-primary deactivated {{ user.id }}"
                                                           href="#" style="display: none"
                                                           data-url='{% url "users_deactivate" user.id %}'
                                                           data-userid="{{ user.id }}">
                                                            <span>{% trans 'Deactivate' %}</span>
                                                        </a>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                    <div class="pagination">
                                            <span class="step-links">
                                                {% if users.has_previous %}
                                                    <a href="?page={{ users.previous_page_number }}">previous</a>
                                                {% endif %}

                                                <span class="current">
                                                    Page {{ users.number }} of {{ users.paginator.num_pages }}.
                                                </span>

                                                {% if users.has_next %}
                                                    <a href="?page={{ users.next_page_number }}">next</a>
                                                {% endif %}
                                            </span>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="card card-plain">
                                <div class="card-header" data-background-color="purple">
                                    <h4 class="title">Table on Plain Background</h4>
                                    <p class="category">Here is a subtitle for this table</p>
                                </div>
                                <div class="card-content table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Salary</th>
                                        <th>Country</th>
                                        <th>City</th>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>Dakota Rice</td>
                                            <td>$36,738</td>
                                            <td>Niger</td>
                                            <td>Oud-Turnhout</td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>Minerva Hooper</td>
                                            <td>$23,789</td>
                                            <td>Curaçao</td>
                                            <td>Sinaai-Waas</td>
                                        </tr>
                                        <tr>
                                            <td>3</td>
                                            <td>Sage Rodriguez</td>
                                            <td>$56,142</td>
                                            <td>Netherlands</td>
                                            <td>Baileux</td>
                                        </tr>
                                        <tr>
                                            <td>4</td>
                                            <td>Philip Chaney</td>
                                            <td>$38,735</td>
                                            <td>Korea, South</td>
                                            <td>Overland Park</td>
                                        </tr>
                                        <tr>
                                            <td>5</td>
                                            <td>Doris Greene</td>
                                            <td>$63,542</td>
                                            <td>Malawi</td>
                                            <td>Feldkirchen in Kärnten</td>
                                        </tr>
                                        <tr>
                                            <td>6</td>
                                            <td>Mason Porter</td>
                                            <td>$78,615</td>
                                            <td>Chile</td>
                                            <td>Gloucester</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $('.btn.btn-primary.deactivated').click(function () {
            var url = $(this).data('url');
            var userid = $(this).data('userid');
            var a = ".btn.btn-primary.activated." + userid;
            var activateurl = $(a);
            var element = $(this);
            swal(
                    {
                        title: "{% trans "Are you sure?" %}",
                        text: "{% trans "You are about to deactivate a user" %}",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "{% trans 'Yes, deactivate it!' %}",
                        cancelButtonText: "Cancel",
                        closeOnConfirm: false
                    }, function () {
                        $.ajax({
                            method: "POST",
                            url: url,
                            data: {"csrfmiddlewaretoken": getCookieValue("csrftoken"),},
                            success: function (res) {
                                if (res.is_deactivated) {
                                    swal({
                                        title: "{% trans "Correct!" %}",
                                        text: "{% trans 'Now the user is deactivated' %}",
                                        type: "success",
                                    }, function () {
                                        element.hide();
                                        $(activateurl).css('display', "");
                                    });
                                } else {
                                    swal({
                                        title: "{% trans 'Opps!' %}",
                                        text: "{% trans 'try again later' %}",
                                        type: "warning"
                                    });
                                }

                            },
                            error: function (xhr) {
                                alert("An error occured: " + xhr.status + " " + xhr.statusText);
                            }
                        });
                    });
        });

        $('.btn.btn-primary.activated').click(function () {
            var url = $(this).data('url');
            var userid = $(this).data('userid');
            var a = ".btn.btn-primary.deactivated." + userid;
            var deactivateurl = $(a);
            var element = $(this);
            swal(
                    {
                        title: "{% trans 'Are you sure?' %}",
                        text: "{% trans 'You are about to activate a user' %}",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "{% trans 'Yes, active it!' %}",
                        cancelButtonText: "{% trans 'Cancel' %}",
                        closeOnConfirm: false
                    }, function () {
                        $.ajax({
                            method: "POST",
                            url: url,
                            data: {"csrfmiddlewaretoken": getCookieValue("csrftoken"),},
                            success: function (res) {
                                if (!res.is_activated) {
                                    swal({
                                        title: "{% trans 'Correct!' %}",
                                        text: "{% trans 'Now the user is active again' %}",
                                        type: "success",
                                    }, function () {
                                        element.hide();
                                        $(deactivateurl).css('display', "");
                                    });
                                } else {
                                    swal({
                                        title: "{% trans 'Opps!' %}",
                                        text: "{% trans 'try again later' %}",
                                        type: "warning"
                                    });
                                }

                            },
                            error: function (xhr) {
                                alert("An error occured: " + xhr.status + " " + xhr.statusText);
                            }
                        });
                    });
        });


    </script>

{% endblock %}
