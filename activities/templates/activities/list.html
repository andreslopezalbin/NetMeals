{% extends 'masterpage/masterpage.html' %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% crispy form form.helper %}
{% load activities_extra %}
{% load i18n %}

{% block title %}List of Activities{% endblock %}
{% block content %}

    <style>
        .flex-center {
            height: auto;
        }

        .view {
            height: auto;
        }
    </style>

    {% if subscription_succeeded or unsubscription_succeeded or activity_created_succeeded or activity_mod_succeeded or activity_del_succeeded %}
        <div class="container alerts">
            <div class="alert alert-success alert-dismissable">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <strong>{{ success_msg }}</strong>
            </div>
        </div>
    {% endif %}


    <div class="delete-popup centered">
        <form id="activity-delete-form" action="" method="post">{% csrf_token %}
            <p>Are you sure you want to delete the activity?</p>
            <div class="row container-fluid">
                <input type="submit" class="col-4 btn btn-primary" value="Confirm"/>
                <div class="col-4"></div>
                <input type="button" class="col-4 cancel btn btn-primary" value="Cancel"/>
            </div>
        </form>
    </div>
    <div class="delete-popup-background"></div>








    <div class="container">
        <main>
            <!--Main layout-->
            <div class="container">

                <!--Page heading-->
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="h1-responsive">{% trans 'All Dishes near you' %}
                        </h1>
                    </div>
                </div>
                <!--/.Page heading-->
                <hr>

                <!--First row-->
                <div class="row wow">
                    <!--First column-->
                    {% for activity_time in activities %}
                        {% with activity_time.activity as activity %}
                            <div class="col-lg-4 wow fadeIn" data-wow-delay="0.{{ forloop.counter }}s"
                                 style=" margin-bottom: 15px;">
                                <!--Card-->
                                <div class="card">
                                    <!--Card image-->
                                    <div class="view overlay hm-white-slight">
                                        <img style="  min-height:250px; max-height:250px; margin: auto;"
                                             src="{{ activity.photo }}"
                                             class="img-fluid" alt=""
                                             onerror="this.src='/static/images/activity-default.svg'">
                                        <a href="{% url "activity_detail" activity_time.id %}">
                                            <div class="mask"></div>
                                        </a>
                                    </div>
                                    <!--/.Card image-->

                                    <!--Card content-->
                                    <div class="card-block">
                                        <!--Title-->
                                        <h4 class="card-title">{{ activity.name }}</h4>
                                        <!--Text-->
                                        <p class="card-text"
                                           style="min-height: 100px; max-height: 100px">{{ activity.short_description }}</p>
                                        <div class="read-more">

                                            {% if user.is_authenticated and activity.owner.id == user.id %}
                                                <a class="btn btn-elegant activity-remove" data-id="{{ activity.id }}">
                                                    Remove
                                                </a>
                                                <a class="btn btn-elegant activity-edit"
                                                   onclick="openURL('{% url 'activity_edit' activity_time.id %}');">Edit
                                                </a>

                                            {% else %}
                                                <a class="btn btn-elegant"
                                                   href="{% url "activity_detail" activity_time.id %}">{% trans 'Details' %}</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <!--/.Card content-->

                                </div>
                                <!--/.Card-->
                            </div>
                        {% endwith %}
                    {% empty %}
                        <div style="min-height: 400px">
                        </div>

                    {% endfor %}
                </div>


                <hr>
            </div>
            <!--/.Main layout-->
        </main>
    </div>


























    {#    <div class="container">#}
    {#        <div class="row">#}
    {#            <div class="col-md-12">#}
    {#                <div class="row">#}
    {#                    {% if activities %}#}
    {#                        {% for activity_time in activities %}#}
    {#                            {% with activity_time.activity as activity %}#}
    {#                                <div class="col-md-4 card" style=" margin: 0.5%;">#}
    {#                                    <a href="{% url "activity_detail" activity_time.id %}"#}
    {#                                       class="activity-list-element">#}
    {#                                        <img alt="{{ activity.name }}" src="{{ activity.photo }}"#}
    {#                                             style="  min-height:250px; max-height:250px; margin: auto;"#}
    {#                                             class="img-fluid"#}
    {#                                             onerror="this.src='/static/images/activity-default.svg'"/>#}
    {##}
    {#                                        <div class="caption">#}
    {#                                            <h3 class="card-title">#}
    {#                                                {{ activity.name }}#}
    {#                                            </h3>#}
    {#                                            <p class="card-text">#}
    {#                                                {{ activity.short_description }}#}
    {#                                            </p>#}
    {#                                        </div>#}
    {#                                    </a>#}
    {#                                    <p>#}
    {#                                        {% if user.is_authenticated and activity.owner.id == user.id %}#}
    {#                                            <button class="btn btn-primary activity-edit"#}
    {#                                                    onclick="openURL('{% url 'activity_edit' activity.id %}');">Edit#}
    {#                                            </button>#}
    {#                                            <button class="btn btn-primary activity-remove" data-id="{{ activity.id }}">#}
    {#                                                Remove#}
    {#                                            </button>#}
    {#                                        {% endif %}#}
    {##}
    {#                                    </p>#}
    {#                                </div>#}
    {#                            {% endwith %}#}
    {#                        {% endfor %}#}
    {##}
    {#                    {% else %}#}
    {#                        <i class="fa fa-exclamation-triangle fa-5x"></i> Nada que mostrar#}
    {#                        <div style="min-height: 400px">#}
    {#                        </div>#}
    {#                    {% endif %}#}
    {#                </div>#}
    {#            </div>#}
    {#        </div>#}
    {#    </div>#}
    <script type="text/javascript">
        $(".alert").fadeTo(3000, 500).slideUp(500, function () {
            $(".alert").slideUp(500);
        });

        $(".activity-remove").click(function () {
            var form = $("#activity-delete-form");
            var id = $(this).data("id");
            var url = "{% url "activity_delete" 0 %}".replace("0", id);
            form.attr('action', url);
            $(".delete-popup").addClass("visible")
            $(".delete-popup-background").addClass("visible")
        });

        $(".delete-popup.centered .cancel").click(function () {
            $(".delete-popup").removeClass("visible")
            $(".delete-popup-background").removeClass("visible")
        });

        function openURL(url) {
            window.open(url, "_self");
        }

    </script>
{% endblock %}